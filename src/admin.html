<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <link rel="stylesheet" type="text/css" href="/src/style.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/jquery-ui-personalized-1.5.2.packed.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/sprinkle.js"></script>

</head>
<body>

<h1>Admin Page</h1>

<div class="container">
    <h2>Add second level authority</h2>
    <form id="secondLevelAuthorityForm">
        <label for="secondLevelAuthorityAddressInput">Address:</label>
        <input type="text" id="secondLevelAuthorityAddressInput" placeholder="Enter Address" required>
        
        <label for="secondLevelAuthorityUsernameInput">Username:</label>
        <input type="text" id="secondLevelAuthorityUsernameInput" placeholder="Username" required>
        
        <label for="secondLevelAuthorityAadhaarInput">Aadhaar:</label>
        <input type="text" id="secondLevelAuthorityAadhaarInput" placeholder="Aadhaar" required>
        
        <button type="button" onclick="addAuthority(2)">Add</button>
    </form>
    
    <h2>Grant second level authority status</h2>
    <form id="secondLevelAuthorityStatusForm">
        <label for="secondLevelAuthorityStatusAddressInput">Address:</label>
        <input type="text" id="secondLevelAuthorityStatusAddressInput" placeholder="Enter Address" required>
        
        <button type="button" onclick="grantAuthorityStatus(2)">Add</button>
    </form>
    
    <h2>Add land inspector</h2>
    <form id="landInspectorForm">
        <label for="landInspectorAddressInput">Address:</label>
        <input type="text" id="landInspectorAddressInput" placeholder="Enter Address" required>
        
        <label for="landInspectorUsernameInput">Username:</label>
        <input type="text" id="landInspectorUsernameInput" placeholder="Username" required>
        
        <label for="landInspectorAadhaarInput">Aadhaar:</label>
        <input type="text" id="landInspectorAadhaarInput" placeholder="Aadhaar" required>
        
        <button type="button" onclick="addAuthority(1)">Add</button>
    </form>
    
    
    <h2>Grant land inspector status</h2>
    <form id="landInspectorStatusForm">
        <label for="landInspectorStatusAddressInput">Address:</label>
        <input type="text" id="landInspectorStatusAddressInput" placeholder="Enter Address" required>
        
        <button type="button" onclick="grantAuthorityStatus(1)">Add</button>
    </form>
    
</div>

<script>
    const contractAddress = "0x9bc39a4a1f3e87cC46CB04bf6d05E53F33BcC110";
    const ganacheEndpoint = "http://127.0.0.1:8545";

    const web3 = new Web3(new Web3.providers.HttpProvider(ganacheEndpoint));

    const contractABI = [
        {
            "constant": true, 
            "inputs": [
                {"name": "_authority", "type": "address"}, 
                {"name": "_username", "type": "string"}, 
                {"name": "_aadhar", "type": "uint256"}
                ],
            "name": "addSecondLevelAuthority",
            "outputs": [
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true, 
            "inputs": [
                {"name": "_authority", "type": "address"}, 
                {"name": "_username", "type": "string"}, 
                {"name": "_aadhar", "type": "uint256"}
                ],
            "name": "addLandInspector",
            "outputs": [
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true, 
            "inputs": [
                {"name": "_account", "type": "address"}
            ],
            "name": "grantLandInspectorStatus",
            "outputs": [
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true, 
            "inputs": [
                {"name": "_account", "type": "address"}
            ],
            "name": "grantSecondLevelAuthorityStatus",
            "outputs": [
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        
    ];

    const accountRegistrationContract = new web3.eth.Contract(contractABI, contractAddress);

    
    async function addAuthority(level) {
        try {
            if (level == 2) 
            {
                await accountRegistrationContract.methods.addSecondLevelAuthority(
                    $("#secondLevelAuthorityAddressInput").val(), 
                    $("#secondLevelAuthorityUsernameInput").val(), 
                    $("#secondLevelAuthorityAadhaarInput").val()
                ).call();
            }
            else
            {
                await accountRegistrationContract.methods.addLandInspector(
                    $("#landInspectorAddressInput").val(), 
                    $("#landInspectorUsernameInput").val(), 
                    $("#landInspectorAadhaarInput").val()
                ).call();
            }
            alert("Successfully added!");

        } catch (error) {
            console.error("An error occurred:", error);
            alert("An error occurred. Check the console for details.");
        }
    }
    
    async function grantAuthorityStatus(level) {
        try {
            if (level == 2) 
            {
                await accountRegistrationContract.methods.grantSecondLevelAuthorityStatus(
                    $("#secondLevelAuthorityStatusAddressInput").val()
                ).call();
            }
            else
            {
                await accountRegistrationContract.methods.grantLandInspectorStatus(
                    $("#landInspectorStatusAddressInput").val()
                ).call();
            }
            alert("Successfully granted!");

        } catch (error) {
            console.error("An error occurred:", error);
            alert("An error occurred. Check the console for details.");
        }
    }
    
    
</script>
</body>
</html>
