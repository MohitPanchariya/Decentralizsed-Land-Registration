<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Land Registration</title>
    <link rel="stylesheet" type="text/css" href="LandRegistration.css">
</head>

<header>
    <nav>
        <div class="logo">
            <a href="#">Blockchain Dapp</a>
        </div>
        <div class="navbar">
            <ul>
                <li><a href="Lands.html">My Lands and requests</a></li>
            </ul>
        </div>
    </nav>
</header>

<body>
    <h1>Land Registration</h1>

    <div>
        <label for="state">State:</label>
        <input type="text" id="state" placeholder="Enter state">
    </div>
    <div>
        <label for="division">Division:</label>
        <input type="text" id="division" placeholder="Enter division">
    </div>
    <div>
        <label for="district">District:</label>
        <input type="text" id="district" placeholder="Enter district">
    </div>
    <div>
        <label for="taluka">Taluka:</label>
        <input type="text" id="taluka" placeholder="Enter taluka">
    </div>
    <div>
        <label for="village">Village:</label>
        <input type="text" id="village" placeholder="Enter village">
    </div>
    <div>
        <label for="surveyNumber">Survey Number:</label>
        <input type="number" id="surveyNumber" placeholder="Enter survey number">
    </div>
    <div>
        <label for="subdivision">Subdivision:</label>
        <input type="text" id="subdivision" placeholder="Enter subdivision">
    </div>
    <div>
        <label for="area">Area:</label>
        <input type="number" id="area" placeholder="Enter area">
    </div>
    <div>
        <label for="purchaseDate">Purchase Date:</label>
        <input type="date" id="purchaseDate">
    </div>
    <div>
        <label for="purchasePrice">Purchase Price:</label>
        <input type="number" id="purchasePrice" placeholder="Enter purchase price">
    </div>
    <div>
        <label for="landValueAtPurchase">Land Value at Purchase:</label>
        <input type="number" id="landValueAtPurchase" placeholder="Enter land value at purchase">
    </div>

    <button type="button" onclick="addLandRecord()">Add Land Record</button>

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.x.x/dist/web3.min.js"></script>
    <script>
    
            let landRegistrationContract;
            
    
            const contractAddress = '0xC5011D75858E21A2fd38F7E7c29EafB7aBC0200F';
            const web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));

            // Load contract ABI from the JSON file
            const loadContractABI = async () => {
                try {
                    const response = await fetch('../build/contracts/LandRegistration.json');
                    const contractData = await response.json();
                    return contractData.abi;
                } catch (error) {
                    console.error('Error loading contract ABI:', error);
                    throw error;
                }
            }
    
            // Use the contract ABI to create an instance of the smart contract
            loadContractABI().then(contractABI => {
                landRegistrationContract = new web3.eth.Contract(contractABI, contractAddress);
            });
    
            async function addLandRecord() {
                const state = document.getElementById('state').value;
                const division = document.getElementById('division').value;
                const district = document.getElementById('district').value;
                const taluka = document.getElementById('taluka').value;
                const village = document.getElementById('village').value;
                const surveyNumber = document.getElementById('surveyNumber').value;
                const subdivision = document.getElementById('subdivision').value;
                const area = document.getElementById('area').value;
                const purchaseDate = new Date(document.getElementById('purchaseDate').value).getTime() / 1000; // Convert to UNIX timestamp
                const purchasePrice = document.getElementById('purchasePrice').value;
                const landValueAtPurchase = document.getElementById('landValueAtPurchase').value;
                
                const accounts = await web3.eth.getAccounts();
                // Create a LandRecord object with the provided values
                const landRecord = {
                    landId: 0, // This will be assigned by the smart contract
                    owner: '0x03A7A674694Ca34E734AeF699765991dCE966aA8', // The owner will be assigned automatically in the smart contract
                    identifier: {
                        state: state,
                        divison: division,
                        district: district,
                        taluka: taluka,
                        village: village,
                        surveyNumber: surveyNumber,
                        subdivision: subdivision,
                    },
                    area: area,
                    purchaseDate: purchaseDate,
                    purchasePrice: purchasePrice,
                    landValueAtPurchase: landValueAtPurchase,
                    previousOwners: [],
                    isVerified: true, 
                    isForSale: false,
                };

               
                try {
                    
                    const result = await landRegistrationContract.methods.addLandRecord(landRecord).send({ from: '0x03A7A674694Ca34E734AeF699765991dCE966aA8',gas: 2000000, gasPrice: '20000000000' });
    
                    console.log('Transaction Result:', result);
                    if(result.status == true) {
                        alert("Land Record Added!")
                    }
    
                    // Add logic to handle the transaction result
                } catch (error) {
                    console.error('Error adding land record:', error);
                    // Handle the error
                }
            }
        
    
    </script>
</body>

</html>
